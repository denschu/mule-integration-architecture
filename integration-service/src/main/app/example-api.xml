<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns:tracking="http://www.mulesoft.org/schema/mule/ee/tracking" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:apikit="http://www.mulesoft.org/schema/mule/apikit" xmlns:cxf="http://www.mulesoft.org/schema/mule/cxf" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:spring="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/apikit http://www.mulesoft.org/schema/mule/apikit/current/mule-apikit.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
http://www.mulesoft.org/schema/mule/cxf http://www.mulesoft.org/schema/mule/cxf/current/mule-cxf.xsd
http://www.mulesoft.org/schema/mule/ee/tracking http://www.mulesoft.org/schema/mule/ee/tracking/current/mule-tracking-ee.xsd" version="EE-3.4.1">

    <spring:beans>
        <spring:import resource="classpath:common-mule-config.xml" />
    </spring:beans>
    
    <http:connector name="http-1" doc:name="HTTP\HTTPS" />
    <http:connector name="http-2" doc:name="HTTP\HTTPS" />

    <apikit:config name="example-api-config" raml="example-api.raml" consoleEnabled="true" consolePath="console" doc:name="Router" />
    <apikit:mapping-exception-strategy name="example-api-apiKitGlobalExceptionMapping">
        <apikit:mapping statusCode="404">
            <apikit:exception value="org.mule.module.apikit.exception.NotFoundException" />
            <set-property propertyName="Content-Type" value="application/json" />
            <set-payload value="{ &quot;message&quot;: &quot;Resource not found&quot; }" />
        </apikit:mapping>
        <apikit:mapping statusCode="405">
            <apikit:exception value="org.mule.module.apikit.exception.MethodNotAllowedException" />
            <set-property propertyName="Content-Type" value="application/json" />
            <set-payload value="{ &quot;message&quot;: &quot;Method not allowed&quot; }" />
        </apikit:mapping>
        <apikit:mapping statusCode="415">
            <apikit:exception value="org.mule.module.apikit.exception.UnsupportedMediaTypeException" />
            <set-property propertyName="Content-Type" value="application/json" />
            <set-payload value="{ &quot;message&quot;: &quot;Unsupported media type&quot; }" />
        </apikit:mapping>
        <apikit:mapping statusCode="406">
            <apikit:exception value="org.mule.module.apikit.exception.NotAcceptableException" />
            <set-property propertyName="Content-Type" value="application/json" />
            <set-payload value="{ &quot;message&quot;: &quot;Not acceptable&quot; }" />
        </apikit:mapping>
        <apikit:mapping statusCode="400">
            <apikit:exception value="org.mule.module.apikit.exception.BadRequestException" />
            <set-property propertyName="Content-Type" value="application/json" />
            <set-payload value="{ &quot;message&quot;: &quot;Bad request&quot; }" />
        </apikit:mapping>
    </apikit:mapping-exception-strategy>
    
    <flow name="example-api-main" doc:name="example-api-main">
        <http:inbound-endpoint address="${inbound.api.url}" connector-ref="http-1" doc:name="HTTP" />
        <logger level="INFO"/>
        <apikit:router config-ref="example-api-config" doc:name="APIkit Router" />
        <exception-strategy ref="example-api-apiKitGlobalExceptionMapping" doc:name="Reference Exception Strategy" />
    </flow>
    <flow name="get:/customers:example-api-config" doc:name="get:/customers:example-api-config">
        <set-payload value="[{&#xA;                &quot;name&quot;: &quot;Athletic Bilbao&quot;,&#xA;                &quot;id&quot;: &quot;ATH&quot;,&#xA;                &quot;homeCity&quot;: &quot;Bilbao&quot;,&#xA;                &quot;stadium&quot;: &quot;San Mames&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Atletico Madrid&quot;,&#xA;                &quot;id&quot;: &quot;ATL&quot;,&#xA;                &quot;homeCity&quot;: &quot;Madrid&quot;,&#xA;                &quot;stadium&quot;: &quot;Vicente Calderon&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Barcelona&quot;,&#xA;                &quot;id&quot;: &quot;BAR&quot;,&#xA;                &quot;homeCity&quot;: &quot;Barcelona&quot;,&#xA;                &quot;stadium&quot;: &quot;Camp Nou&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Betis&quot;,&#xA;                &quot;id&quot;: &quot;BET&quot;,&#xA;                &quot;homeCity&quot;: &quot;Seville&quot;,&#xA;                &quot;stadium&quot;: &quot;Benito Villamarin&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Espanyol&quot;,&#xA;                &quot;id&quot;: &quot;ESP&quot;,&#xA;                &quot;homeCity&quot;: &quot;Barcelona&quot;,&#xA;                &quot;stadium&quot;: &quot;Cornella-El Prat&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Getafe&quot;,&#xA;                &quot;id&quot;: &quot;GET&quot;,&#xA;                &quot;homeCity&quot;: &quot;Getafe&quot;,&#xA;                &quot;stadium&quot;: &quot;Coliseum Alfonso Perez&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Granada&quot;,&#xA;                &quot;id&quot;: &quot;GRA&quot;,&#xA;                &quot;homeCity&quot;: &quot;Granada&quot;,&#xA;                &quot;stadium&quot;: &quot;Nuevo Los Carmenes&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Levante&quot;,&#xA;                &quot;id&quot;: &quot;LEV&quot;,&#xA;                &quot;homeCity&quot;: &quot;Valencia&quot;,&#xA;                &quot;stadium&quot;: &quot;Ciutat de Valencia&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Malaga&quot;,&#xA;                &quot;id&quot;: &quot;MAL&quot;,&#xA;                &quot;homeCity&quot;: &quot;Malaga&quot;,&#xA;                &quot;stadium&quot;: &quot;La Roselda&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Mallorca&quot;,&#xA;                &quot;id&quot;: &quot;MAL&quot;,&#xA;                &quot;homeCity&quot;: &quot;Palma&quot;,&#xA;                &quot;stadium&quot;: &quot;Iberostar Stadium&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Osasuna&quot;,&#xA;                &quot;id&quot;: &quot;OSA&quot;,&#xA;                &quot;homeCity&quot;: &quot;Pamplona&quot;,&#xA;                &quot;stadium&quot;: &quot;El Sadar&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Racing Santander&quot;,&#xA;                &quot;id&quot;: &quot;RAC&quot;,&#xA;                &quot;homeCity&quot;: &quot;Santander&quot;,&#xA;                &quot;stadium&quot;: &quot;El Sardinero&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Rayo Vallecano&quot;,&#xA;                &quot;id&quot;: &quot;RAY&quot;,&#xA;                &quot;homeCity&quot;: &quot;Madrid&quot;,&#xA;                &quot;stadium&quot;: &quot;Campo de Vallecas&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Real Madrid&quot;,&#xA;                &quot;id&quot;: &quot;RMA&quot;,&#xA;                &quot;homeCity&quot;: &quot;Madrid&quot;,&#xA;                &quot;stadium&quot;: &quot;Santiago Bernabeu&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Real Sociedad&quot;,&#xA;                &quot;id&quot;: &quot;RSC&quot;,&#xA;                &quot;homeCity&quot;: &quot;San Sebastian&quot;,&#xA;                &quot;stadium&quot;: &quot;Anoeta&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Sevilla&quot;,&#xA;                &quot;id&quot;: &quot;SEV&quot;,&#xA;                &quot;homeCity&quot;: &quot;Seville&quot;,&#xA;                &quot;stadium&quot;: &quot;Ramon Sanchez Pizjuan&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Sporting de Gijon&quot;,&#xA;                &quot;id&quot;: &quot;SPG&quot;,&#xA;                &quot;homeCity&quot;: &quot;Gijon&quot;,&#xA;                &quot;stadium&quot;: &quot;El Molinon&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Valencia&quot;,&#xA;                &quot;id&quot;: &quot;VAL&quot;,&#xA;                &quot;homeCity&quot;: &quot;Valencia&quot;,&#xA;                &quot;stadium&quot;: &quot;Mestalla&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Villareal&quot;,&#xA;                &quot;id&quot;: &quot;VIL&quot;,&#xA;                &quot;homeCity&quot;: &quot;Vila-real&quot;,&#xA;                &quot;stadium&quot;: &quot;El Madrigal&quot;&#xA;              },&#xA;              {&#xA;                &quot;name&quot;: &quot;Zaragoza&quot;,&#xA;                &quot;id&quot;: &quot;ZAR&quot;,&#xA;                &quot;homeCity&quot;: &quot;Zaragoza&quot;,&#xA;                &quot;stadium&quot;: &quot;La Romareda&quot;&#xA;              }]" doc:name="Set Payload" />
    </flow>
    <flow name="get:/customers/{customerId}:example-api-config" doc:name="get:/customers/{customerId}:example-api-config">
        <custom-transformer class="de.codecentric.integration.example.transformer.CustomerRequestTransformer" doc:name="Request Transformer"/>
        <http:outbound-endpoint address="${outbound.customers.url}" exchange-pattern="request-response" responseTimeout="20000" connector-ref="http-2" doc:name="HTTP">
			<cxf:jaxws-client serviceClass="com.example.xmlns.customers.CustomersWS" operation="GetCustomer" port="backendCustomersWS"/>
		</http:outbound-endpoint>
		<custom-transformer class="org.mule.module.json.transformers.XmlToJson" doc:name="XmlToJSON Transformer"/>
    </flow>
</mule>
